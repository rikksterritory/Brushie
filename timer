<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Brushie — 8-bit Prototype</title>
  <style>
    :root{
      /* Friendly pastel palette */
      --bg1:#fff3fb;
      --bg2:#e8f7ff;
      --panel:#ffffffcc;
      --panel2:#ffffffb8;

      --ink:#22314f;
      --muted:#5d6c8a;

      --mint:#7ef0d4;
      --sky:#8fd3ff;
      --lilac:#c9b8ff;
      --lemon:#ffe38a;
      --pink:#ffb6d5;

      --border:#c9d7ff;
      --shadow: 0 12px 0 rgba(35,45,80,0.10);

      --px:4px;
      --font: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--ink);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background:
        radial-gradient(circle at 15% 20%, rgba(255,182,213,.55), transparent 40%),
        radial-gradient(circle at 85% 25%, rgba(143,211,255,.55), transparent 45%),
        radial-gradient(circle at 50% 85%, rgba(201,184,255,.55), transparent 45%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    .frame{
      width:min(560px, 100%);
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border: 3px solid var(--border);
      box-shadow: var(--shadow);
      padding: 18px;
      position:relative;
      backdrop-filter: blur(6px);
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom: 12px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 8px 10px;
      border: 3px solid var(--border);
      background:#ffffff;
      box-shadow: 0 8px 0 rgba(35,45,80,0.08);
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-size: 12px;
      color: var(--muted);
    }

    .dot{
      width: calc(var(--px) * 3);
      height: calc(var(--px) * 3);
      background: var(--lemon);
      box-shadow: 0 0 0 3px #fff;
      border: 2px solid rgba(34,49,79,0.15);
    }

    .title{
      font-size: 14px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--muted);
    }

    .hero{
      border: 3px solid var(--border);
      background:#ffffff;
      padding: 14px;
      box-shadow: 0 10px 0 rgba(35,45,80,0.08);
    }

    .timer{
      font-size: 64px;
      line-height: 1;
      letter-spacing: 2px;
      text-align:center;
      margin: 8px 0 10px;
      text-shadow: 0 4px 0 rgba(0,0,0,0.06);
    }

    .sub{
      text-align:center;
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 12px;
      min-height: 16px;
    }

    /* Pastel progress meter */
    .mouth{
      width:100%;
      height: 30px;
      border: 3px solid var(--border);
      background: linear-gradient(90deg, #ffffff, #f7fbff);
      position: relative;
      overflow:hidden;
      box-shadow: inset 0 0 0 3px rgba(0,0,0,0.03);
    }
    .mouth .fill{
      height:100%;
      width:0%;
      background:
        linear-gradient(90deg, rgba(126,240,212,0.55), rgba(143,211,255,0.55));
      border-right: 3px solid rgba(34,49,79,0.10);
      transition: width 120ms linear;
    }
    .mouth .teeth{
      position:absolute;
      inset: 0;
      pointer-events:none;
      opacity:0.28;
      background:
        repeating-linear-gradient(90deg, transparent 0 18px, rgba(34,49,79,0.12) 18px 20px),
        repeating-linear-gradient(0deg, transparent 0 14px, rgba(34,49,79,0.08) 14px 16px);
      mix-blend-mode: multiply;
    }

    .controls{
      display:flex;
      gap:10px;
      margin-top: 14px;
      flex-wrap: wrap;
      justify-content:center;
    }

    button{
      font-family: var(--font);
      border: 3px solid var(--border);
      background:#ffffff;
      color: var(--ink);
      padding: 10px 14px;
      min-width: 120px;
      box-shadow: 0 10px 0 rgba(35,45,80,0.08);
      cursor:pointer;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      font-size: 12px;
    }
    button:active{
      transform: translateY(6px);
      box-shadow: 0 4px 0 rgba(35,45,80,0.08);
    }
    button[disabled]{ opacity: 0.6; cursor:not-allowed; }
    .primary{
      background: linear-gradient(180deg, #ffffff, #f6fffb);
      border-color: rgba(126,240,212,0.9);
    }
    .primary .k{ color: #0a8d78; }
    .warn{
      background: linear-gradient(180deg, #ffffff, #fff5f9);
      border-color: rgba(255,182,213,0.95);
    }

    .footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: 11px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap: wrap;
    }

    /* === Brushing UI (8-bit edition) === */
    .scene{
      margin-top: 14px;
      border: 3px solid var(--border);
      background: linear-gradient(180deg, #f7fbff, #fff);
      box-shadow: inset 0 0 0 3px rgba(0,0,0,0.03);
      padding: 14px;
      display:flex;
      justify-content:center;
      align-items:center;
      position: relative;
      overflow:hidden;
      min-height: 132px;
    }

    /* pixel confetti (square dots) */
    .scene:before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(rgba(0,0,0,0) 0 0),
        repeating-linear-gradient(90deg, transparent 0 22px, rgba(201,184,255,.45) 22px 26px, transparent 26px 40px),
        repeating-linear-gradient(0deg, transparent 0 18px, rgba(255,182,213,.35) 18px 22px, transparent 22px 34px);
      opacity:0.35;
      mix-blend-mode:multiply;
      pointer-events:none;
    }

    .toothWrap{
      position: relative;
      width: 220px;
      height: 100px;
      z-index:1;
    }

    /* Make everything look pixelated */
    .toothWrap *{ image-rendering: pixelated; }

    /* Tooth (blocky, no radius) */
    .tooth{
      position:absolute;
      left: 50%;
      top: 52%;
      width: 88px;
      height: 64px;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 3px solid rgba(34,49,79,0.18);
      border-radius: 0;
      box-shadow:
        0 10px 0 rgba(35,45,80,0.10),
        4px 0 0 rgba(34,49,79,0.06),
        -4px 0 0 rgba(34,49,79,0.06),
        0 -4px 0 rgba(34,49,79,0.06);
    }

    /* bottom “roots” as blocky chunks */
    .tooth:before, .tooth:after{
      content:"";
      position:absolute;
      bottom:-16px;
      width: 34px;
      height: 30px;
      background:#fff;
      border: 3px solid rgba(34,49,79,0.18);
      border-top: none;
      border-radius: 0;
      box-shadow: 0 10px 0 rgba(35,45,80,0.10);
    }
    .tooth:before{ left: 4px; }
    .tooth:after{ right: 4px; }

    .face{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction: column;
      gap: 10px;
      pointer-events:none;
    }

    .eyes{
      display:flex;
      gap: 18px;
      margin-top: 10px;
    }
    .eye{
      width: 12px; height: 12px;
      background: var(--ink);
      border: 3px solid #d9ecff;
      box-shadow: 0 3px 0 rgba(35,45,80,0.08);
      border-radius: 0;
    }
    .smile{
      width: 34px; height: 10px;
      background: var(--ink);
      border: 3px solid #d9ecff;
      box-shadow: 0 3px 0 rgba(35,45,80,0.08);
      border-radius: 0;
    }

    /* Toothbrush as chunky pixels */
    .brush{
      position:absolute;
      top: 26px;
      left: 12px;
      width: 96px;
      height: 24px;
      z-index: 3;
      filter: drop-shadow(0 6px 0 rgba(35,45,80,0.10));
    }

    .handle{
      position:absolute;
      left: 0;
      top: 6px;
      width: 56px;
      height: 12px;
      background: var(--lilac);
      border: 3px solid rgba(34,49,79,0.18);
      border-radius: 0;
      box-shadow:
        inset 0 0 0 3px rgba(255,255,255,0.35),
        6px 6px 0 rgba(143,211,255,0.45);
    }

    .head{
      position:absolute;
      left: 56px;
      top: 3px;
      width: 26px;
      height: 18px;
      background: #fff;
      border: 3px solid rgba(34,49,79,0.18);
      border-radius: 0;
    }

    .bristles{
      position:absolute;
      left: 60px;
      top: 6px;
      width: 18px;
      height: 12px;
      background:
        repeating-linear-gradient(90deg,
          rgba(126,240,212,.95) 0 4px,
          rgba(255,182,213,.95) 4px 8px
        );
      border: 2px solid rgba(34,49,79,0.12);
      border-radius: 0;
    }

    .shine{
      position:absolute;
      left: 10px;
      top: 8px;
      width: 6px;
      height: 6px;
      background: rgba(255,255,255,0.75);
      box-shadow: 12px 0 0 rgba(255,255,255,0.35);
      opacity: 0.9;
    }

    /* Foam as pixel squares */
    .foam{
      position:absolute;
      left: 90px;
      top: 36px;
      width: 72px;
      height: 40px;
      opacity: 0;
      pointer-events:none;
      z-index: 4;
      filter: drop-shadow(0 4px 0 rgba(35,45,80,0.08));
    }
    .foam .px{
      position:absolute;
      width: 8px;
      height: 8px;
      background:#fff;
      border: 2px solid rgba(34,49,79,0.10);
      border-radius: 0;
    }
    .p1{ left: 0;  top: 8px; }
    .p2{ left: 10px; top: 0; }
    .p3{ left: 20px; top: 10px; }
    .p4{ left: 32px; top: 4px; }
    .p5{ left: 44px; top: 12px; }
    .p6{ left: 56px; top: 6px; }
    .p7{ left: 12px; top: 20px; opacity:.9; }
    .p8{ left: 28px; top: 22px; opacity:.85; }
    .p9{ left: 50px; top: 24px; opacity:.9; }

    /* === Choppy 8-bit motion === */
    .state-running .brush{
      /* circles first, then horizontal */
      animation: brushPattern8 1.4s steps(10, end) infinite;
    }
    .state-running .foam{
      opacity: 1;
      animation: foamJitter 0.55s steps(5, end) infinite;
    }
    .state-done .toothWrap{
      animation: happyBounce8 0.7s steps(4, end) 2;
    }

    @keyframes brushPattern8{
      /* 0% → ~60%: circle scrub (blocky loop) */
      0%   { transform: translate(6px,  0px) rotate(-6deg); }
      8%   { transform: translate(18px,-4px) rotate(-4deg); }
      16%  { transform: translate(34px,-2px) rotate(-2deg); }
      24%  { transform: translate(44px, 6px) rotate( 2deg); }
      32%  { transform: translate(34px,14px) rotate( 4deg); }
      40%  { transform: translate(18px,12px) rotate( 6deg); }
      48%  { transform: translate(8px,  6px) rotate( 2deg); }
      56%  { transform: translate(6px,  0px) rotate(-6deg); }

      /* 60% → 100%: horizontal scrub (back-and-forth) */
      60%  { transform: translate(12px, 2px) rotate(-4deg); }
      70%  { transform: translate(52px, 0px) rotate( 4deg); }
      80%  { transform: translate(92px, 2px) rotate(-4deg); }
      90%  { transform: translate(52px, 0px) rotate( 4deg); }
      100% { transform: translate(12px, 2px) rotate(-4deg); }
    }

    @keyframes foamJitter{
      0%   { transform: translate(0,0); }
      25%  { transform: translate(2px,-2px); }
      50%  { transform: translate(0,-1px); }
      75%  { transform: translate(-2px,-2px); }
      100% { transform: translate(0,0); }
    }

    @keyframes happyBounce8{
      0%   { transform: translateY(0); }
      25%  { transform: translateY(-10px); }
      50%  { transform: translateY(0); }
      75%  { transform: translateY(-6px); }
      100% { transform: translateY(0); }
    }

    /* Run/Pause/Done badge dot */
    .state-idle .dot{ background: var(--lemon); }
    .state-running .dot{ background: var(--mint); }
    .state-done .dot{ background: var(--pink); }
  </style>
</head>

<body>
  <main class="frame state-idle" id="app" aria-label="Brushie timer">
    <div class="topbar">
      <div class="badge" aria-live="polite">
        <span class="dot" aria-hidden="true"></span>
        <span id="statusText">Ready</span>
      </div>
      <div class="title">Brushie</div>
    </div>

    <section class="hero">
      <div class="timer" id="timeDisplay" aria-label="Time remaining">2:00</div>
      <div class="sub" id="subText">Press START and brush gently.</div>

      <div class="mouth" role="progressbar" aria-valuemin="0" aria-valuemax="120" aria-valuenow="0" aria-label="Brushing progress">
        <div class="fill" id="fill"></div>
        <div class="teeth" aria-hidden="true"></div>
      </div>

      <!-- Self-brushing UI -->
      <div class="scene" aria-label="Animated brushing buddy">
        <div class="toothWrap" aria-hidden="true">
          <div class="brush">
            <div class="handle"></div>
            <div class="head"></div>
            <div class="bristles"></div>
            <div class="shine"></div>
          </div>

          <div class="foam">
            <div class="px p1"></div><div class="px p2"></div><div class="px p3"></div>
            <div class="px p4"></div><div class="px p5"></div><div class="px p6"></div>
            <div class="px p7"></div><div class="px p8"></div><div class="px p9"></div>
          </div>

          <div class="tooth">
            <div class="face">
              <div class="eyes">
                <div class="eye"></div>
                <div class="eye"></div>
              </div>
              <div class="smile"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="primary" id="startPauseBtn" aria-label="Start timer">
          <span class="k">Start</span> / Pause
        </button>
        <button id="resetBtn" aria-label="Reset timer">Reset</button>
        <button class="warn" id="skipBtn" aria-label="Skip to done">Skip</button>
      </div>
    </section>

    <div class="footer">
      <div class="hint">Tip: aim for small circles, don’t scrub.</div>
      <div class="hint" id="kbHint">Keys: Space = Start/Pause, R = Reset</div>
    </div>
  </main>

  <script>
    (() => {
      const TOTAL_SECONDS = 120;

      const app = document.getElementById("app");
      const statusText = document.getElementById("statusText");
      const subText = document.getElementById("subText");
      const timeDisplay = document.getElementById("timeDisplay");
      const fill = document.getElementById("fill");
      const progressEl = document.querySelector(".mouth");

      const startPauseBtn = document.getElementById("startPauseBtn");
      const resetBtn = document.getElementById("resetBtn");
      const skipBtn = document.getElementById("skipBtn");

      let remaining = TOTAL_SECONDS;
      let running = false;
      let tickTimer = null;
      let endAt = null;

      function setState(state) {
        app.classList.remove("state-idle", "state-running", "state-done");
        app.classList.add(`state-${state}`);
      }

      function formatTime(seconds) {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        return `${m}:${String(s).padStart(2, "0")}`;
      }

      function updateUI() {
        timeDisplay.textContent = formatTime(remaining);
        const elapsed = TOTAL_SECONDS - remaining;
        const pct = Math.min(100, Math.max(0, (elapsed / TOTAL_SECONDS) * 100));
        fill.style.width = pct + "%";
        progressEl.setAttribute("aria-valuenow", String(elapsed));
      }

      // --- Sound effects (tiny 8-bit clicks) ---
      function sfxStart() {
        try {
          const AudioCtx = window.AudioContext || window.webkitAudioContext;
          const ctx = new AudioCtx();
          const o = ctx.createOscillator();
          const g = ctx.createGain();

          o.type = "square";
          g.gain.value = 0.05;

          o.connect(g);
          g.connect(ctx.destination);

          const t = ctx.currentTime;
          o.frequency.setValueAtTime(520, t);
          o.frequency.exponentialRampToValueAtTime(880, t + 0.08);

          g.gain.setValueAtTime(0.05, t);
          g.gain.exponentialRampToValueAtTime(0.0001, t + 0.10);

          o.start(t);
          o.stop(t + 0.11);

          setTimeout(() => ctx.close?.(), 150);
        } catch {}
      }

      function sfxReset() {
        try {
          const AudioCtx = window.AudioContext || window.webkitAudioContext;
          const ctx = new AudioCtx();
          const o = ctx.createOscillator();
          const g = ctx.createGain();

          o.type = "square";
          g.gain.value = 0.05;

          o.connect(g);
          g.connect(ctx.destination);

          const t = ctx.currentTime;
          o.frequency.setValueAtTime(440, t);
          o.frequency.exponentialRampToValueAtTime(220, t + 0.10);

          g.gain.setValueAtTime(0.05, t);
          g.gain.exponentialRampToValueAtTime(0.0001, t + 0.12);

          o.start(t);
          o.stop(t + 0.13);

          setTimeout(() => ctx.close?.(), 180);
        } catch {}
      }

      function beep() {
        // End-of-timer chirp
        try {
          const AudioCtx = window.AudioContext || window.webkitAudioContext;
          const ctx = new AudioCtx();
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = "square";
          o.frequency.value = 880;
          g.gain.value = 0.03;
          o.connect(g); g.connect(ctx.destination);
          o.start();
          o.frequency.setValueAtTime(880, ctx.currentTime);
          o.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.12);
          setTimeout(() => { o.stop(); ctx.close?.(); }, 180);
        } catch {}
      }

      function vibrate() {
        if ("vibrate" in navigator) navigator.vibrate([80, 40, 120]);
      }

      function done() {
        running = false;
        clearInterval(tickTimer);
        tickTimer = null;
        remaining = 0;

        setState("done");
        statusText.textContent = "All done!";
        subText.textContent = "Nice! Rinse, smile, and floss if you can.";
        updateUI();

        beep();
        vibrate();
      }

      function start() {
        sfxStart();

        if (running) return;
        if (remaining <= 0) remaining = TOTAL_SECONDS;

        running = true;
        setState("running");
        statusText.textContent = "Brushing…";
        subText.textContent = "Keep going — gentle circles.";

        endAt = Date.now() + remaining * 1000;

        clearInterval(tickTimer);
        tickTimer = setInterval(() => {
          const msLeft = endAt - Date.now();
          const nextRemaining = Math.max(0, Math.ceil(msLeft / 1000));

          if (nextRemaining !== remaining) {
            remaining = nextRemaining;
            updateUI();
          }
          if (remaining <= 0) done();
        }, 100);
      }

      function pause() {
        if (!running) return;

        running = false;
        clearInterval(tickTimer);
        tickTimer = null;

        setState("idle");
        statusText.textContent = "Paused";
        subText.textContent = "Press START to continue.";
        updateUI();
      }

      function reset() {
        sfxReset();

        running = false;
        clearInterval(tickTimer);
        tickTimer = null;

        remaining = TOTAL_SECONDS;
        setState("idle");
        statusText.textContent = "Ready";
        subText.textContent = "Press START and brush gently.";
        updateUI();
      }

      startPauseBtn.addEventListener("click", () => (running ? pause() : start()));
      resetBtn.addEventListener("click", reset);
      skipBtn.addEventListener("click", done);

      window.addEventListener("keydown", (e) => {
        if (e.code === "Space") {
          e.preventDefault();
          running ? pause() : start();
        }
        if (e.key.toLowerCase() === "r") reset();
      });

      setState("idle");
      updateUI();
    })();
  </script>
</body>
</html>
